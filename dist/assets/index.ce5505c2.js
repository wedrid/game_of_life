import*as r from"https://cdn.skypack.dev/three@0.126.1";import{g as h,G as u}from"./vendor.d628c093.js";import{OrbitControls as m}from"https://unpkg.com/three@0.126.1/examples/jsm/controls/OrbitControls.js";const f=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};f();class g{constructor(t,e,i){this.epoch_time=i,this.rows=t,this.cols=e,this.world_model=Array(t).fill().map(()=>Array(e).fill(0)),this.pause=!1,this.observers=[]}setEpochTime(t){this.epoch_time=t}randomConfiguration(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)Math.random()>=.5?this.setAlive(t,e):this.setDead(t,e);this.notifyObservers()}notifyObservers(){for(let t=0;t<this.observers.length;t++)this.observers[t].notify(this.world_model)}subscribe(t){this.observers.push(t)}clearModel(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.setDead(t,e);this.notifyObservers()}pauseTrigger(){this.pause=!0}playTrigger(){this.pause=!1}checkPause(){return this.pause}setAlive(t,e){if(t>=this.rows||e>=this.cols)throw"Tried to set alive an invalid coordinate";this.world_model[t][e]=1}setDead(t,e){if(t>=this.rows||e>=this.cols)throw"Tried to set dead an invalid coordinate";this.world_model[t][e]=0}changeState(t,e){if(t>=this.rows||e>=this.cols)throw"Tried to set dead an invalid coordinate";this.world_model[t][e]==0?this.setAlive(t,e):this.setDead(t,e),this.notifyObservers()}sleep(t){return new Promise((e,i)=>{setTimeout(e,t)})}async startProgressLoop(){for(;;)this.pause||this.calculateNextEpoch(),await this.sleep(this.epoch_time)}calculateNextEpoch(){for(var t=Array(this.rows).fill().map(()=>Array(this.cols).fill(0)),e=0;e<this.rows;e++)for(var i=0;i<this.cols;i++)if(e==0||e==this.rows-1||i==0||i==this.cols)t[e][i]=this.world_model[e][i];else{var s=this.world_model[e-1][i-1]+this.world_model[e-1][i]+this.world_model[e-1][i+1]+this.world_model[e][i-1]+this.world_model[e][i+1]+this.world_model[e+1][i-1]+this.world_model[e+1][i]+this.world_model[e+1][i+1];this.world_model[e][i]==1&&(s==2||s==3)&&(t[e][i]=1),this.world_model[e][i]==0&&s==3&&(t[e][i]=1)}this.world_model=t,this.notifyObservers()}}class p{constructor(t,e,i){this.rows=t,this.cols=e,this.idsMatrix=Array(t).fill().map(()=>Array(e).fill(0)),this.initScene(),this.editing=!1,document.addEventListener("mousedown",()=>{this.mouse.x=event.clientX/innerWidth*2-1,this.mouse.y=-(event.clientY/innerHeight)*2+1})}setController(t){this.controller=t}notify(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.cols;i++)t[e][i]==1?this.setCellAlive(e,i):this.setCellDead(e,i)}initScene(){this.scene=new r.Scene,this.camera=new r.PerspectiveCamera(70,innerWidth/innerHeight,1,1e3),this.camera.position.z=27,this.canvas=document.querySelector("canvas.webgl"),this.renderer=new r.WebGLRenderer({canvas:this.canvas,alpha:!0}),this.renderer.setSize(innerWidth,innerHeight),this.renderer.setPixelRatio(devicePixelRatio),document.body.appendChild(this.renderer.domElement),this.orbit=new m(this.camera,this.renderer.domElement);let t=new r.DirectionalLight(16777215,1);t.position.set(0,0,1),this.scene.add(t),this.mouse=new r.Vector2,this.mouse.x=void 0,this.mouse.y=void 0,this.raycaster=new r.Raycaster,this.initGrid()}enableEditMode(){this.mouse.x=void 0,this.mouse.y=void 0,this.editing=!0,this.orbit.enabled=!1}disableEditMode(){this.editing=!1,this.orbit.enabled=!0}cellCoordinate(t){let e=-1,i=0;const s=[-1,-1];for(i=0;i<this.idsMatrix.length;i++)e=this.idsMatrix[i].indexOf(t),e>=0&&(s[0]=i,s[1]=e);return s}pauseMode(){let t=38,e=38,i=38;document.body.style.backgroundColor="rgb("+t+","+e+","+i+")"}playMode(){document.body.style.backgroundColor="black"}editModel(t){const e=this.cellCoordinate(t);this.controller.updateModel(e[0],e[1])}setCellAlive(t,e){const i=this.scene.getObjectById(this.idsMatrix[t][e],!0);var s=i,o=new r.Color(i.material.color.getHex()),n=new r.Color(65280);h.timeline().to(i.position,{duration:.5,z:2,ease:"expo"}).to(o,{duration:.5,r:n.r,g:n.g,b:n.b,ease:"expo",onUpdate:function(){s.material.color=o}},"<")}setCellDead(t,e){const i=this.scene.getObjectById(this.idsMatrix[t][e],!0);var s=i,o=new r.Color(i.material.color.getHex()),n=new r.Color(255);h.timeline().to(i.position,{duration:.5,z:0,ease:"expo"}).to(o,{duration:.5,r:n.r,g:n.g,b:n.b,ease:"expo",onUpdate:function(){s.material.color=o}},"<")}initGrid(){var t=this.cols,e=this.rows,i=1.5;this.gui_grid=new r.Object3D;for(var s=0;s<e;s+=1)for(var o=0;o<t;o+=1){var n=new r.BoxGeometry(1,1,1),a=new r.Mesh(n,new r.MeshBasicMaterial({color:255}));a.position.x=(s-t/2)*i,a.position.y=(o-e/2)*i,this.gui_grid.add(a),this.idsMatrix[s][o]=a.id}this.scene.add(this.gui_grid),this.scene.updateMatrixWorld()}animate(){requestAnimationFrame(this.animate.bind(this)),this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.intersectObjects(this.gui_grid.children);for(let e=0;e<t.length;e++)this.editing&&(this.editModel(t[e].object.id),this.mouse.x=void 0,this.mouse.y=void 0);this.render(this.scene,this.camera)}render(){this.renderer.render(this.scene,this.camera)}}class w{constructor(t,e){t.subscribe(e),this.model=t,this.view=e,this.configureDatGui(),this.view.setController(this)}updateModel(t,e){this.model.changeState(t,e)}configureDatGui(){this.dat_gui=new u({autoPlace:!1});var t=document.getElementById("my-gui-container");t.appendChild(this.dat_gui.domElement),this.gui_controls={Play:()=>{this.model.playTrigger(),this.view.playMode()},Pause:()=>{this.model.pauseTrigger(),this.view.pauseMode()},Clear:()=>{this.model.clearModel()},Edit:!1,Epoch_time:this.model.epoch_time,Random_config:()=>{this.model.randomConfiguration()}},this.dat_gui.add(this.gui_controls,"Play"),this.dat_gui.add(this.gui_controls,"Pause"),this.dat_gui.add(this.gui_controls,"Clear"),this.dat_gui.add(this.gui_controls,"Edit").onChange(e=>{e?this.view.enableEditMode():this.view.disableEditMode()}),this.dat_gui.add(this.gui_controls,"Epoch_time").onChange(e=>{this.model.setEpochTime(e)}).name("Epoch time (ms)").min(10),this.dat_gui.add(this.gui_controls,"Random_config").name("Random configuration"),this.dat_gui.open()}}const c=new p(60,60),d=new g(60,60,1e3);new w(d,c);d.randomConfiguration();d.startProgressLoop();c.animate();
